# LFRIS Marketing Docs

This is the repo for Liferay Marketing Team's documentation site.
Link: https://mktg-docs.liferay.com/

## Getting Started

1. `git clone https://github.com/liferay/lfris-marketing-docs.gits`
2. `npm i`
3. Create `.env.development` and `.env.production` files, ask a webteam member for the necessary environment variables
4. Start development server `npm run dev` - go to `http://localhost:8000`
5. Start a production server `npm run build` then `npm run serve` and go to `http://localhost:9000`

For additional information: [Gatsby Documentation](https://www.gatsbyjs.org/docs/)

## Implementation Details

### Gatsby

This site is built with [gatsby](https://www.gatsbyjs.org/), a react-based static site generator. Please use their to [tutorial](https://www.gatsbyjs.org/tutorial/) to familiarize yourself.

We initiliazied this site with [this gatsby starter](https://github.com/diegonvs/gatsby-boilerplate), but we've made many changes. We've also based many components and implementation decisions on mktg-docs.liferay.com's sister site: [liferay.design](https://liferay.design/). [Repo Link](https://github.com/liferay-design/liferay.design/).

### Netlify

Served through netlify

### Auth

#### Logging In

Almost all pages are gated. They are only accessible through signing in to the site with a `@liferay.com` email address. Users can login through netlify by using the sign up tab and their liferay email, but it is recommended (and easier) to sign in using the `continue with google` button since `@liferay.com` emails are google accounts anyways.

#### Netlify Identity

Since we are using [Netlify Identity](https://docs.netlify.com/visitor-access/identity/) as our authentication service, we use `react-netlify-identity-widget` to manage our auth. [`Auth`](https://github.com/liferay/lfris-marketing-docs/blob/master/src/components/organisms/Auth/index.js) is the wrapper component that controls rendering based on if the user is logged in.

Documentation for `react-netlify-identity`: https://github.com/sw-yx/react-netlify-identity

Documentation for `react-netlify-identity-widget`: https://github.com/sw-yx/react-netlify-identity-widget

Code Demo Video: https://www.youtube.com/watch?v=vrSoLMmQ46k

Gatsby Demo Repo: https://github.com/jlengstorf/gatsby-netlify-identity-functions

#### How to Ungate/Gate a page

By default https://mktg-docs.liferay.com/search, https://mktg-docs.liferay.com/deploy, and all pages generated by Google Docs are gated.

To ungate pages generated by Google Docs:

1. Select google doc that you wish to ungate
2. Fill the description with the following JSON Object:

```
{
  "...",
  "needsAuth": false,
}
```

### Search

#### Elastic Lunr Search

We use elastic's [lunr search](http://elasticlunr.com/). We use [this plugin](https://www.gatsbyjs.org/packages/@gatsby-contrib/gatsby-plugin-elasticlunr-search/) to make our search indexes available in graphql.

The [`<Search>`](https://github.com/liferay/lfris-marketing-docs/tree/master/src/components/molecules/Search) manages all things related to search. It has two views, one for use in the navigation and on for use on https://mktg-docs.liferay.com/search.

`<SearchForm>` is for user input and `<SearchResults>` displays the results. `index.js` manages the state for both.

### Data

Since we are using Gatsby, Graphql manages our data/ is our source of data.

#### Google Docs

Most of the purpose of building this site out has been to provide marketers with an easy way of writing documentation. Since they largely use Google Docs, we've decided to use Google Docs as our main source of data.

We use [gatsby-source-google-docs](https://www.gatsbyjs.org/packages/gatsby-source-google-docs/?=gatsby-source-google-docs) to easily use Google Docs' API and source its data into Graphql.

If you want to set up your own documentation site, follow the set up instructions found in the above link and use the relevant environment variables (found in `gatsby-config.js`)

If you want to contribute to open source, help improve the plugin, or to debug problems, it's been useful to look through the google docs api documentation: https://developers.google.com/docs/api/reference/rest

Sidenote: `gatsby-source-google-docs` sources data from google drive and google docs (hence the need for both api), transforms that into JSON, uses [json2md](https://www.npmjs.com/package/json2md) to convert the json into markdown so that the document's data can be available through `allMarkdownRemark`

##### Additional data

Users can add additional data to their files by adding a JSON object to the description field. [Documentation](https://www.gatsbyjs.org/packages/gatsby-source-google-docs/#add-extra-data). None of these are required, but if users want to take the extra step, they can use these fields.

Here is an example of what to place into the description:

```
{
	"path": "/web/general/events",
	"title": "General Events",
	"description": "This is the document for general insights into how to set up events.",
	"needsAuth": "false"
}
```

Here is a table for the available fields and what they are:
| Field | Description | Type |
| ------- | ------------------ | ------- |

#### Markdown Files

### Theme

Theme based off of lfris-www's foundations styles and clayui

### Misc plugins and packages

## To see documentation changes

### locally

### on a production site
